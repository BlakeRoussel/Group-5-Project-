---
title: "Interactive"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
editor_options: 
  chunk_output_type: console
runtime: shiny
author: "Blake Roussel"
date: "April 17, 2018"
---

```{r setup, include=FALSE}
library(tidyverse)
library(flexdashboard)
library(plotly)
library(tidyr)
```



```{r}
con <- dplyr::src_mysql(
  host = "ba-isdsclass-programdev.lsu.edu",
  port = 3306,
  user = 'student',
  password = 'student',
  dbname = "isds_3105") 

```


```{r}
commencement <- tbl(con, 'commencement')
alumnus <- tbl(con, 'alumnus')
currentPosition <- tbl(con, 'currentPosition')
location <- tbl(con, 'location')
internship <- tbl(con,'internship')
organization <- tbl(con,'organization')
title <- tbl(con,'title')
college <- tbl(con, 'college')
graduation <- tbl(con, 'graduation')
graduationTitle <- tbl(con, 'graduationTitle')


```

```{r}
#curpos <- currentPosition %>% collect() %>% drop_na(locationId) 
#Next we need to join tables: e.g. we need location and major in the same table. Also we get that we need to merge it with map data so we can plot. 

```

```{r}
major <-  graduation %>% left_join(graduationTitle, by = c('graduationId', 'graduationId')) %>% left_join(title, by = c('idTitle', 'idTitle')) %>% select(graduationId, majorName)

h <- major %>% left_join(currentPosition, by = c('graduationId', 'graduationId')) %>% select(graduationId, majorName, locationId) %>% left_join(location, by =c('locationId', 'locationId')) 

#2,835 have locationId's the rest are null. However, you can make the assumption to the organizationId accordingly. 
```

```{r}
#This drops all elements with NAs as locationId
h1 <- h %>% collect() %>% drop_na(locationId)

```
```{r}
#This joins mapdata with our table so we can make a map. Its has over 1 million element though so im not sure if its 100% correct.
states <- map_data("state")
mutate(h1, statelower = tolower(stateFull)) %>% right_join(states, by = c('statelower' = 'region')) -> mmap

```

```{r}
# this makes a map but it fills by majorName and we need spacific elements of majorName like: 'Construction Management' or 'Petroleum Engineering' if some knows how to?
ggplot(data = mmap) + 
  geom_polygon(aes(x = long, y = lat, group = group, fill = majorName), color = "black") + 
  coord_fixed(1.3) +
  guides(fill=F)
  labs(title = 'Test')
```




